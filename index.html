<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>ShulTime v3.0</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
    :root { 
        --primary: #0D2B4F; 
        --bg: #F2F4F8; 

        /* TEFILLAH COLORS */
        --color-Shacharis: #2E7D32; 
        --color-Mincha: #E65100;    
        --color-Maariv: #1565C0;    

        /* NUSACH BACKGROUNDS */
        --bg-Ashkenaz: #E3F2FD;         
        --bg-Sefard: #E8F5E9;           
        --bg-Ari: #F3E5F5;              
        --bg-Edot-HaMizrach: #FFF3E0;  
        --bg-Chabad: #FFF8E1;           
        --bg-Other: #F5F5F5;            
        
        /* NUSACH TEXT */
        --text-Ashkenaz: #1565C0;
        --text-Sefard: #2E7D32;
        --text-Ari: #7B1FA2;
        --text-Edot-HaMizrach: #E65100;
        --text-Chabad: #F57F17;
        --text-Other: #616161;
    }
    
    html, body { margin: 0; padding: 0; height: 100%; overscroll-behavior-y: contain; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Roboto", sans-serif; background: var(--bg); overflow: hidden; }
    
    /* FLOATING HEADER & DISPLAY SEARCH */
    .floating-header {
        position: fixed; top: 15px; left: 10px; right: 10px;
        z-index: 1000; display: flex; gap: 10px; align-items: center; pointer-events: none;
    }
    .search-container {
        flex: 1; display: flex; align-items: center; pointer-events: auto;
        background: #fff; height: 50px; border-radius: 25px; cursor: pointer;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15); padding: 0 20px;
        overflow: hidden; transition: all 0.2s;
    }
    .search-container:active { transform: scale(0.98); background: #fafafa; }
    
    #dummy-search-text {
        font-size: 16px; font-weight: 500; color: #888; width: 100%;
        white-space: nowrap; overflow: hidden; text-overflow: ellipsis;
    }

    .circle-btn {
        width: 50px; height: 50px; flex-shrink: 0; pointer-events: auto;
        border-radius: 50%; background: #fff; border: none;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center;
        cursor: pointer; color: var(--primary); transition: all 0.2s;
    }

    /* SEARCH OVERLAY */
    #search-overlay {
        position: fixed; top: 100%; left: 0; right: 0; height: 100%;
        background: var(--bg); z-index: 5000; 
        transition: top 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        display: flex; flex-direction: column;
    }
    #search-overlay.open { top: 0; }
    
    .search-overlay-header {
        display: flex; align-items: center; gap: 10px; padding: 15px 12px; 
        background: #fff; box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        padding-top: max(15px, env(safe-area-inset-top));
    }
    .search-overlay-input-wrap {
        flex: 1; height: 45px; background: #f0f2f5; border-radius: 22px; 
        overflow: visible; padding: 0 15px; display: flex; align-items: center;
    }
    gmp-place-autocomplete { width: 100%; height: 100%; background-color: transparent !important; }
    gmp-place-autocomplete::part(input) { background-color: transparent !important; padding: 0; font-size: 16px; height: 100%; width: 100%; color: #111; font-weight: 500; outline: none; border: none; }

    .search-now-btn {
        width: 100%; background: var(--primary); color: #fff; border: none; 
        padding: 16px; border-radius: 25px; font-size: 16px; font-weight: 800; 
        cursor: pointer; box-shadow: 0 4px 15px rgba(13, 43, 79, 0.2); 
        display: flex; align-items: center; justify-content: center; gap: 8px;
        transition: transform 0.1s;
    }
    .search-now-btn:active { transform: scale(0.98); }

    /* STATUS PILLS */
    .status-area {
        position: fixed; top: 75px; left: 0; right: 0;
        display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 6px;
        z-index: 800; pointer-events: none; padding: 0 10px;
    }
    #status-pill, #count-pill, #map-radius-pill {
        padding: 4px 10px; border-radius: 20px; font-size: 11px; font-weight: 700;
        display: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1); white-space: nowrap;
        max-width: 45%; overflow: hidden; text-overflow: ellipsis; pointer-events: auto;
    }
    #status-pill { background: rgba(13, 43, 79, 0.95); color: #fff; }
    #count-pill { background: #fff; color: var(--primary); border: 1px solid var(--primary); }
    #map-radius-pill { background: #2E7D32; color: #fff; }

    /* STICKY HEADER */
    .sticky-header {
        position: fixed; top: 0; left: 0; right: 0; height: 60px;
        background: rgba(242, 244, 248, 0.85); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
        border-bottom: 1px solid rgba(0,0,0,0.05); z-index: 900; 
        display: flex; align-items: flex-end; justify-content: center;
        padding-bottom: 12px; font-weight: 800; font-size: 17px; color: var(--primary);
        opacity: 0; transition: opacity 0.2s ease-in-out; pointer-events: none;
    }
    .sticky-header.visible { opacity: 1; pointer-events: auto; }

    /* VIEWS */
    #list-view { position: absolute; inset: 0; padding: 110px 10px 120px 10px; overflow-y: auto; background: var(--bg); z-index: 10; display: none; }
    #settings-view, #zmanim-view { position: absolute; inset: 0; padding: 20px 10px 120px 10px; overflow-y: auto; background: var(--bg); z-index: 10; display: none; }
    #map-view { position: absolute; inset: 0; z-index: 5; }

    .list-page-header { font-size: 34px; font-weight: 800; color: var(--primary); margin-top: 10px; margin-bottom: 15px; padding-left: 5px; }

    /* MAP MARKERS */
    #center-marker {
        position: fixed; top: 50%; left: 50%; width: 16px; height: 16px;
        background: #2196F3; border: 3px solid #fff; border-radius: 50%;
        transform: translate(-50%, -50%); z-index: 20; box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        pointer-events: none; display: none;
    }
    .custom-marker { 
        padding: 6px 10px; border-radius: 12px; font-size: 14px; font-weight: 800; 
        box-shadow: 0 3px 8px rgba(0,0,0,0.3); display: flex; align-items: center; justify-content: center; 
        position: relative; top: 10px; cursor: pointer; background: #fff; border: 2px solid #fff;
    }
    .custom-marker::after { content: ''; position: absolute; bottom: -6px; left: 50%; transform: translateX(-50%); border-width: 6px 6px 0; border-style: solid; border-color: inherit transparent transparent transparent; }

    /* CARDS */
    .minyan-card {
        background: #fff; border-radius: 12px; margin-bottom: 8px;
        display: flex; justify-content: space-between; align-items: stretch;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05); overflow: hidden; height: 95px; 
    }
    .info-zone { 
        flex: 1; padding: 10px 12px; cursor: pointer; display: flex; flex-direction: column; 
        justify-content: flex-start; min-width: 0; border-right: 1px solid #f0f0f0; 
    }
    .map-zone { 
        width: 110px; flex-shrink: 0; display: flex; flex-direction: column; 
        justify-content: space-between; align-items: flex-end; padding: 8px 10px; 
        background: #fafafa; cursor: pointer; box-sizing: border-box;
    }
    
    .shul-name { font-weight: 800; font-size: 17px; color: #333; line-height: 1.1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; margin-bottom: 2px; }
    .shul-address { font-size: 12px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; line-height: 1.2; }
    .nusach-tag-list { font-size: 10px; padding: 2px 8px; border-radius: 8px; display: inline-block; font-weight: 700; text-transform: uppercase; width: fit-content; margin-top: 6px; }

    .tefillah-label { font-size: 11px; font-weight: 900; text-transform: uppercase; color: #555; text-align: right; line-height: 1; } 
    .time-val-card { padding: 4px 8px; border-radius: 8px; font-weight: 800; font-size: 13px; white-space: nowrap; margin-top: auto; margin-bottom: auto; }
    .dist-row { display: flex; align-items: center; justify-content: flex-end; gap: 4px; }
    .dist-label { font-size: 11px; font-weight: 800; color: #666; }
    .map-circle { width: 26px; height: 26px; border-radius: 50%; background: #fff; display: flex; align-items: center; justify-content: center; border: 1px solid #eee; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
    .google-maps-icon { background: linear-gradient(135deg, #4285F4 25%, #34A853 25% 50%, #FBBC05 50% 75%, #EA4335 75%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; font-size: 16px !important; font-weight: bold; }

    /* FILTERS */
    #filter-drawer { display: none; position: fixed; top: 80px; left: 12px; right: 12px; background: #fff; border-radius: 20px; padding: 15px; box-shadow: 0 10px 40px rgba(0,0,0,0.25); z-index: 2000; max-width: 500px; margin: 0 auto; max-height: 75vh; overflow-y: auto;}
    .filter-section { margin-bottom: 15px; } 
    .filter-label { font-size: 10px; font-weight: 800; color: #bbb; text-transform: uppercase; margin-bottom: 5px; display: block; }
    .chip-group { display: flex; flex-wrap: wrap; gap: 6px; }
    
    .chip { padding: 6px 12px; border-radius: 15px; border: 1px solid #ddd; background: #fff; font-size: 12px; font-weight: 600; cursor: pointer; transition: all 0.1s; color: #555; }
    .chip.active { box-shadow: 0 2px 5px rgba(0,0,0,0.1); transform: scale(1.05); }
    .chip-all.active { background: var(--primary) !important; color: #fff !important; border-color: var(--primary) !important; }

    /* DETAILS DRAWER */
    #details-drawer { position: fixed; bottom: -100%; left: 10px; right: 10px; height: 75vh; background: #fff; border-radius: 25px; z-index: 3000; margin-bottom: 15px; box-shadow: 0 5px 30px rgba(0,0,0,0.3); transition: transform 0.3s ease-out; display: flex; flex-direction: column; padding: 0; }
    #details-drawer.open { bottom: 0; transform: translateY(0); }
    #scrim { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 2500; display: none; }
    .drawer-header { padding: 15px 20px; display: flex; justify-content: space-between; align-items: flex-start; border-bottom: 1px solid #f0f0f0; }
    .drawer-body { flex: 1; overflow-y: auto; padding: 20px; }
    .schedule-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; font-size: 14px; margin-top: 10px; }
    .contact-row { display: flex; gap: 8px; margin-top: 20px; flex-wrap: wrap; }
    .contact-btn { background: #f5f5f5; border: 1px solid #ddd; padding: 8px 12px; border-radius: 20px; font-weight: 700; font-size: 12px; text-decoration: none; color: #333; display: flex; align-items: center; justify-content: center; gap: 4px; white-space: nowrap; flex: 1; }
    
    /* TOOLBAR */
    .floating-toolbar { position: fixed; bottom: 30px; left: 20px; right: 20px; background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); border: 1px solid rgba(255,255,255,0.3); display: flex; justify-content: space-between; align-items: center; padding: 8px 10px; z-index: 1500; border-radius: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #999; font-size: 10px; font-weight: 600; gap: 3px; border: none; background: transparent; flex: 1; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); position: relative; padding: 8px 4px; margin: 0 2px; border-radius: 20px; }
    .nav-item.active { color: var(--primary); font-weight: 900; background: rgba(255, 255, 255, 0.6); transform: translateY(-3px); }
    .nav-item i { font-size: 24px; }

    .nusach-bg-Ashkenaz { background-color: var(--bg-Ashkenaz) !important; color: var(--text-Ashkenaz) !important; }
    .nusach-bg-Sefard { background-color: var(--bg-Sefard) !important; color: var(--text-Sefard) !important; }
    .nusach-bg-Ari { background-color: var(--bg-Ari) !important; color: var(--text-Ari) !important; }
    .nusach-bg-Edot-HaMizrach { background-color: var(--bg-Edot-HaMizrach) !important; color: var(--text-Edot-HaMizrach) !important; }
    .nusach-bg-Chabad { background-color: var(--bg-Chabad) !important; color: var(--text-Chabad) !important; }
    .nusach-bg-Other { background-color: var(--bg-Other) !important; color: var(--text-Other) !important; }

    .fab-location { position: fixed; bottom: 100px; right: 20px; width: 50px; height: 50px; background: #fff; border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,0.2); border: none; color: var(--primary); display: flex; align-items: center; justify-content: center; z-index: 900; }
    .time-pill { display: inline-block; padding: 4px 10px; border-radius: 12px; font-weight: 800; font-size: 14px; margin: 2px; border: 1px solid rgba(0,0,0,0.08); }

    /* ZMANIM & SETTINGS */
    .zman-card { background: #fff; border-radius: 12px; padding: 12px 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.03); display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; border-left: 4px solid var(--primary); }
    .settings-card { background: #fff; border-radius: 16px; padding: 20px; margin-bottom: 15px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .settings-input { width: 100%; padding: 12px; border: 1px solid #eee; border-radius: 12px; font-size: 16px; background: #fafafa; box-sizing: border-box; }
</style>
</head>
<body>

    <div id="sticky-header" class="sticky-header"></div>

    <div class="floating-header" id="filter-header">
        <div class="search-container" onclick="openSearchOverlay()">
            <div id="dummy-search-text">Search City...</div>
        </div>
        <button class="circle-btn" onclick="toggleFilters()"><i class="material-icons">tune</i></button>
    </div>

    <div id="search-overlay">
        <div class="search-overlay-header">
            <button class="circle-btn" style="width:40px; height:40px; background:#f0f0f0; box-shadow:none;" onclick="closeSearchOverlay()">
                <i class="material-icons" style="color:#555;">arrow_back</i>
            </button>
            <div class="search-overlay-input-wrap">
                <gmp-place-autocomplete id="gmp-autocomplete" placeholder="Search City, Zip Code..."></gmp-place-autocomplete>
            </div>
        </div>
        
        <div style="padding: 20px;">
            <button class="search-now-btn" onclick="executeManualSearch()">
                <i class="material-icons">search</i> Search Now
            </button>
        </div>

        <div style="flex:1; display:flex; align-items:flex-start; justify-content:center; padding:20px; text-align:center;">
            <div style="color:#999; margin-top: 20px;">
                <i class="material-icons" style="font-size:48px; margin-bottom:10px; opacity:0.5;">travel_explore</i><br>
                Search for a city, zip code, or address.
            </div>
        </div>
    </div>

    <div class="status-area">
        <div id="status-pill"></div>
        <div id="count-pill"></div>
        <div id="map-radius-pill"></div>
    </div>

    <div id="center-marker"></div>
    <div id="scrim" onclick="closeDetails()"></div>

    <div id="details-drawer">
        <div class="drawer-header">
            <div style="flex:1; padding-right: 10px;">
                <div id="drawer-title" style="font-weight:800; font-size:18px; color:var(--primary); line-height: 1.1;"></div>
                <div id="drawer-address" style="font-size:13px; color:#777;"></div>
            </div>
            <div style="display:flex; gap:12px;">
                <button class="circle-btn" style="width:40px; height:40px; background:#f0f0f0;" onclick="toggleFavorite()"><i class="material-icons" id="drawer-fav-icon">bookmark_border</i></button>
                <button class="circle-btn" style="width:40px; height:40px; background:#f0f0f0;" onclick="closeDetails()"><i class="material-icons">close</i></button>
            </div>
        </div>
        <div id="drawer-content" class="drawer-body"></div>
    </div>

    <div id="filter-drawer">
        <div class="filter-section">
            <label class="filter-label">Sort By</label>
            <div class="chip-group" id="sort-group">
                <div class="chip active chip-all" onclick="setFilter('sort', 'time', this)">Time</div>
                <div class="chip" onclick="setFilter('sort', 'distance', this)">Distance</div>
                <div class="chip" onclick="setFilter('sort', 'abc', this)">A-Z</div>
            </div>
        </div>
        <div class="filter-section">
            <label class="filter-label">Radius (Miles)</label>
            <div style="display:flex; align-items:center; gap:10px;">
                <input type="range" min="0.1" max="99" step="0.1" value="20" id="radius-slider" style="flex:1;" oninput="manualRadiusUpdate(this.value)">
                <input type="number" id="radius-input" value="20" style="width:50px;" onchange="manualRadiusUpdate(this.value)">
            </div>
        </div>
        <div style="display:flex; gap:10px;">
            <button style="flex:1; padding:12px; border-radius:15px; border:none;" onclick="resetFilters()">Reset</button>
            <button style="flex:2; background:var(--primary); color:#fff; padding:12px; border-radius:15px; border:none;" onclick="toggleFilters()">Done</button>
        </div>
    </div>

    <div id="list-view"></div>
    <div id="map-view"></div>
    <div id="zmanim-view"></div>
    <div id="settings-view">
        <div class="list-page-header">Settings</div>
        <p style="padding-left: 5px; color:#666;">ShulTime v3.0</p>
        <div class="settings-card">
            <input type="text" class="settings-input" id="profile-name" placeholder="Name" oninput="saveProfile()">
        </div>
    </div>

    <button class="fab-location" id="fab-location" onclick="useMyLocation()"><i class="material-icons">my_location</i></button>

    <div class="floating-toolbar">
        <button class="nav-item" id="nav-recent" onclick="switchTab('recent')"><i class="material-icons">history</i>Recent</button>
        <button class="nav-item" id="nav-zmanim" onclick="switchTab('zmanim')"><i class="material-icons">access_time</i>Zmanim</button>
        <button class="nav-item active" id="nav-toggle" onclick="toggleView()"><i class="material-icons" id="nav-toggle-icon">list</i><span id="nav-toggle-text">List</span></button>
        <button class="nav-item" id="nav-saved" onclick="switchTab('saved')"><i class="material-icons">bookmark_border</i>Saved</button>
        <button class="nav-item" id="nav-settings" onclick="switchTab('settings')"><i class="material-icons">settings</i>Settings</button>
    </div>

    <script>
        // Core Logic
        let map, geocoder, fullDbData = [], allMinyanim = [], searchCenter = null, currentRadius = 20;
        let filters = { tefillah: '', nusach: '', sort: 'time' };
        let markers = [];
        let currentTab = 'map';
        let currentFilterDate = new Date();
        let isProgrammaticMove = false;

        async function initApp(){
            const { Map } = await google.maps.importLibrary("maps");
            const { Place } = await google.maps.importLibrary("places");
            geocoder = new google.maps.Geocoder();

            map = new Map(document.getElementById("map-view"), {
                center: { lat: 40.091, lng: -74.218 }, zoom: 12, mapId: "DEMO_MAP_ID", disableDefaultUI: true
            });

            map.addListener('idle', () => {
                if(isProgrammaticMove) return;
                const c = map.getCenter();
                searchCenter = {lat: c.lat(), lng: c.lng()};
                
                geocoder.geocode({ location: c }).then(res => {
                    if(res.results[0]) {
                        let name = res.results[0].formatted_address.split(',')[0];
                        updateDummySearch(name);
                    }
                });
                applyFilters();
            });

            // FIXED AUTOCOMPLETE LOGIC
            const autocompleteEl = document.getElementById("gmp-autocomplete");
            if(autocompleteEl) {
                autocompleteEl.addEventListener("gmp-placeselect", async (e) => {
                    const place = e.place;
                    if (!place) return;

                    await place.fetchFields({ fields: ["location", "displayName", "formattedAddress"] });
                    
                    if (place.location) {
                        const lat = place.location.lat();
                        const lng = place.location.lng();
                        const name = place.displayName || place.formattedAddress;
                        
                        setSearchLocation(lat, lng, name);
                        closeSearchOverlay();
                        autocompleteEl.value = ""; // Clear for next time
                    }
                });
            }

            // Load Data
            fetch("database.json").then(r => r.json()).then(data => {
                fullDbData = data;
                processMinyanim();
            }).catch(() => console.log("Check database.json"));
        }

        function updateDummySearch(name) {
            const dummy = document.getElementById("dummy-search-text");
            if (dummy) { dummy.innerText = name; dummy.style.color = '#111'; }
            document.getElementById('status-pill').innerText = "Near: " + name;
        }

        function setSearchLocation(lat, lng, name) {
            searchCenter = {lat, lng};
            updateDummySearch(name);

            if(map) { 
                isProgrammaticMove = true;
                map.setCenter(searchCenter); 
                map.setZoom(13); 
                setTimeout(() => { isProgrammaticMove = false; applyFilters(); }, 600);
            }
            if(currentTab !== 'list' && currentTab !== 'map') switchTab('map');
        }

        async function executeManualSearch() {
            const autocompleteEl = document.getElementById("gmp-autocomplete");
            const query = autocompleteEl.value; // Accessing value directly
            
            if (!query) return closeSearchOverlay();

            try {
                const res = await geocoder.geocode({ address: query });
                if (res.results[0]) {
                    const loc = res.results[0].geometry.location;
                    setSearchLocation(loc.lat(), loc.lng(), res.results[0].formatted_address.split(',')[0]);
                    closeSearchOverlay();
                }
            } catch (e) { alert("Location not found."); }
        }

        function openSearchOverlay() { document.getElementById('search-overlay').classList.add('open'); }
        function closeSearchOverlay() { document.getElementById('search-overlay').classList.remove('open'); }

        // Logic Helpers (Existing from your code)
        function processMinyanim() {
            allMinyanim = fullDbData.map(s => ({...s, timeValue: 0, timeDisplay: "Info"})); // Simplified for demo
            renderWelcome();
        }

        function applyFilters() {
            if(!searchCenter) return;
            const results = allMinyanim.map(m => {
                m.distance = getDistance(searchCenter.lat, searchCenter.lng, m.lat, m.lng);
                return m;
            }).filter(m => m.distance <= currentRadius);
            
            renderList(results);
            updateMapMarkers(results);
        }

        function renderList(results) {
            const container = document.getElementById('list-view');
            container.innerHTML = results.map(m => `
                <div class="minyan-card">
                    <div class="info-zone" onclick='openDetails(${JSON.stringify(m)})'>
                        <div class="shul-name">${m.name}</div>
                        <div class="shul-address">${m.address}</div>
                    </div>
                    <div class="map-zone">
                        <div class="dist-label">${m.distance.toFixed(1)}mi</div>
                    </div>
                </div>
            `).join('');
        }

        async function updateMapMarkers(results) {
            if(!map) return;
            const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");
            markers.forEach(m => m.map = null); markers = [];
            results.forEach(m => {
                const pin = document.createElement('div');
                pin.className = 'custom-marker'; pin.innerText = "Shul";
                const marker = new AdvancedMarkerElement({ map, position: {lat:m.lat, lng:m.lng}, content: pin });
                markers.push(marker);
            });
        }

        function getDistance(lat1, lon1, lat2, lon2){
            const R = 3958.8;
            const dLat = (lat2-lat1)*Math.PI/180;
            const dLon = (lon2-lon1)*Math.PI/180;
            const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
            return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a)));
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById('list-view').style.display = (tab==='list'||tab==='map') ? 'block' : 'none';
            document.getElementById('map-view').style.display = (tab==='map') ? 'block' : 'none';
            document.getElementById('settings-view').style.display = (tab==='settings') ? 'block' : 'none';
            if(tab==='map' || tab==='list') document.getElementById('nav-toggle').classList.add('active');
            else document.getElementById('nav-'+tab).classList.add('active');
        }

        function toggleView() { switchTab(currentTab === 'map' ? 'list' : 'map'); }
        function renderWelcome() { document.getElementById('list-view').innerHTML = '<div style="padding:100px 20px; text-align:center;">Search to begin.</div>'; }
        function toggleFilters() { const d = document.getElementById('filter-drawer'); d.style.display = (d.style.display==='block'?'none':'block'); }

    </script>
    <script async src="https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&loading=async&libraries=places,maps,marker&callback=initApp"></script>
</body>
</html>
