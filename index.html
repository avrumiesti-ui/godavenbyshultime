<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>ShulTime</title>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
<script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>

<style>
    :root { --primary: #0D2B4F; --bg: #F2F4F8; --accent: #2196F3; }
    
    html, body { margin: 0; padding: 0; height: 100%; overscroll-behavior-y: contain; }
    body { font-family: -apple-system, BlinkMacSystemFont, "Roboto", sans-serif; background: var(--bg); overflow: hidden; }
    
    /* --- FLOATING HEADER --- */
    .floating-header {
        position: fixed; top: 15px; left: 12px; right: 12px;
        z-index: 1000; display: flex; gap: 10px; align-items: center; pointer-events: auto;
    }
    .search-container {
        flex: 1; pointer-events: auto; display: flex; align-items: center;
        background: #fff; height: 50px; border-radius: 25px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15); padding: 0 15px;
        overflow: hidden; transition: box-shadow 0.2s;
    }
    .search-container:focus-within { box-shadow: 0 4px 20px rgba(0,0,0,0.25); }

    /* GOOGLE COMPONENT STYLING */
    gmp-place-autocomplete { 
        width: 100%; height: 100%;
        --gmp-filled-input-container-color: #fff !important;
        --gmp-filled-input-outline-color: transparent !important;
        background-color: #fff !important;
    }
    gmp-place-autocomplete::part(input) { 
        box-shadow: none !important; outline: none !important; border: none !important;
        background-color: #fff !important; padding: 0; font-size: 16px; 
        height: 100%; width: 100%; color: #111 !important; font-weight: 500 !important;
    }

    .circle-btn {
        width: 50px; height: 50px; flex-shrink: 0;
        border-radius: 50%; background: #fff; border: none;
        box-shadow: 0 4px 15px rgba(0,0,0,0.15); display: flex; align-items: center; justify-content: center;
        cursor: pointer; color: var(--primary); transition: transform 0.1s;
    }
    .circle-btn:active { transform: scale(0.95); }
    .circle-btn.active { background: var(--primary); color: #fff; }

    /* --- MAP & LIST CONTAINERS --- */
    #list-view { 
        position: absolute; inset: 0; 
        padding: 80px 12px 100px; /* Top padding for header */
        overflow-y: auto; background: var(--bg); 
        z-index: 10; display: block;
    }
    #map-view { position: absolute; inset: 0; z-index: 5; }

    /* --- "SEARCH THIS AREA" BUTTON --- */
    #search-area-btn {
        position: fixed; top: 85px; left: 50%; transform: translateX(-50%);
        background: #fff; color: var(--primary); font-weight: 700; font-size: 13px;
        padding: 8px 16px; border-radius: 20px; border: none;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 900;
        display: none; cursor: pointer; align-items: center; gap: 6px;
    }

    /* --- MINYAN CARDS --- */
    .minyan-card {
        background: #fff; border-radius: 16px; margin-bottom: 10px;
        display: flex; justify-content: space-between; align-items: stretch;
        box-shadow: 0 2px 8px rgba(0,0,0,0.04); overflow: hidden; 
        min-height: 90px; transition: transform 0.1s;
    }
    .minyan-card:active { transform: scale(0.98); }

    .info-zone { 
        flex: 1; padding: 12px 14px; cursor: pointer; 
        display: flex; flex-direction: column; justify-content: center;
        min-width: 0; 
    }
    .map-zone { 
        width: 100px; display: flex; flex-direction: column; align-items: center; justify-content: center;
        border-left: 1px solid #f0f0f0; cursor: pointer; background: #fafafa; padding: 12px;
        flex-shrink: 0; text-align: center;
    }
    
    .shul-name { font-weight: 800; font-size: 17px; color: #222; margin-bottom: 4px; line-height: 1.2; }
    .shul-details { font-size: 13px; color: #666; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    
    .time-big { font-weight: 800; font-size: 22px; color: var(--primary); line-height: 1; }
    .time-sub { font-size: 11px; font-weight: 700; color: #888; text-transform: uppercase; margin-top: 2px; }
    .dist-tag { font-size: 11px; background: #e0e0e0; padding: 2px 6px; border-radius: 4px; margin-top: 6px; color: #444; font-weight: 600; }

    /* --- BADGES & CHIPS --- */
    .nusach-badge { 
        font-size: 10px; padding: 3px 8px; border-radius: 6px; 
        display: inline-block; font-weight: 700; text-transform: uppercase; 
        margin-top: 6px; letter-spacing: 0.5px;
    }
    /* Dynamic Nusach Colors */
    .n-Ashkenaz { background: #E3F2FD; color: #1565C0; }
    .n-Sefard { background: #E8F5E9; color: #2E7D32; }
    .n-Ari { background: #F3E5F5; color: #7B1FA2; }
    .n-Edot-HaMizrach { background: #FFF3E0; color: #E65100; }
    .n-Other { background: #F5F5F5; color: #616161; }

    /* --- FILTER DRAWER --- */
    #filter-drawer {
        display: none; position: fixed; top: 80px; left: 12px; right: 12px;
        background: #fff; border-radius: 20px; padding: 20px;
        box-shadow: 0 10px 40px rgba(0,0,0,0.25); z-index: 2000;
        max-width: 500px; margin: 0 auto; animation: slideDown 0.2s ease-out;
    }
    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); }}

    .filter-label { font-size: 11px; font-weight: 800; color: #999; text-transform: uppercase; margin-bottom: 8px; display: block; letter-spacing: 0.5px; }
    .chip-group { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; }
    .chip { 
        padding: 8px 14px; border-radius: 12px; border: 1px solid #eee; background: #fff; 
        font-size: 13px; font-weight: 600; color: #555; cursor: pointer; 
    }
    .chip.active { background: var(--primary); color: #fff; border-color: var(--primary); }
    
    .time-row { display: flex; gap: 10px; margin-bottom: 20px; }
    .time-input { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 10px; text-align: center; font-weight: 600; font-family: inherit; }
    .apply-btn { width: 100%; background: var(--primary); color: #fff; border: none; padding: 12px; border-radius: 12px; font-weight: 700; font-size: 14px; }

    /* --- DETAILS DRAWER --- */
    #details-drawer {
        position: fixed; bottom: 0; left: 0; right: 0; height: 80vh;
        background: #fff; border-radius: 20px 20px 0 0; 
        z-index: 3000; transform: translateY(105%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1);
        display: flex; flex-direction: column; box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
    }
    #details-drawer.open { transform: translateY(0); }
    .drawer-header { padding: 15px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
    .drawer-body { flex: 1; overflow-y: auto; padding: 20px; }
    
    .schedule-grid { display: grid; grid-template-columns: 1fr; gap: 10px; margin-top: 15px; }
    .schedule-row { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed #eee; font-size: 14px; }
    .day-label { font-weight: 700; color: #555; width: 100px; }
    .times-list { text-align: right; color: #222; font-weight: 500; }

    #scrim { position: fixed; inset: 0; background: rgba(0,0,0,0.3); z-index: 2500; display: none; backdrop-filter: blur(2px); }
    
    .fab-location {
        position: fixed; bottom: 30px; right: 20px; width: 56px; height: 56px;
        background: #fff; border-radius: 50%; box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        border: none; color: var(--primary); display: flex; align-items: center; justify-content: center; z-index: 900;
    }
    
    .empty-state { text-align: center; color: #777; margin-top: 60px; padding: 0 40px; }
    
    /* CUSTOM MAP MARKER STYLE */
    .custom-marker { 
        background: var(--primary); color: white; padding: 4px 8px; 
        border-radius: 8px; font-size: 12px; font-weight: 700; 
        box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: 2px solid #fff;
        text-align: center; min-width: 30px;
    }
</style>
</head>
<body>

    <div class="floating-header">
        <div class="search-container">
            <div id="autocomplete-container" style="flex:1; height:100%;"></div>
        </div>
        <button class="circle-btn" onclick="toggleFilters()">
            <i class="material-icons">tune</i>
        </button>
        <button class="circle-btn" id="view-toggle-btn" onclick="toggleView()">
            <i class="material-icons" id="view-icon">map</i>
        </button>
    </div>

    <button id="search-area-btn" onclick="searchCurrentMapArea()">
        <i class="material-icons" style="font-size:16px;">refresh</i> Search this area
    </button>

    <div id="list-view">
        <div class="empty-state">
            <i class="material-icons" style="font-size:48px; opacity:0.3; margin-bottom:10px;">synagogue</i>
            <p>Search for a city or click the target icon to find minyanim near you.</p>
        </div>
    </div>
    <div id="map-view"></div>

    <button class="fab-location" onclick="useMyLocation()">
        <i class="material-icons">my_location</i>
    </button>

    <div id="scrim" onclick="closeDetails()"></div>
    
    <div id="details-drawer">
        <div class="drawer-header">
            <h3 style="margin:0; font-size:18px;">Shul Details</h3>
            <button onclick="closeDetails()" style="border:none; background:none; font-size:24px; color:#555;">&times;</button>
        </div>
        <div class="drawer-body" id="drawer-content"></div>
    </div>

    <div id="filter-drawer">
        <div class="filter-label">Tefillah</div>
        <div class="chip-group" id="tefillah-chips">
            <div class="chip active" onclick="setFilter('tefillah', '', this)">All</div>
            <div class="chip" onclick="setFilter('tefillah', 'Shacharis', this)">Shacharis</div>
            <div class="chip" onclick="setFilter('tefillah', 'Mincha', this)">Mincha</div>
            <div class="chip" onclick="setFilter('tefillah', 'Maariv', this)">Maariv</div>
        </div>

        <div class="filter-label">Nusach</div>
        <div class="chip-group" id="nusach-chips">
            </div>

        <div class="filter-label">Time Range</div>
        <div class="time-row">
            <input type="time" id="time-start" class="time-input" onchange="applyFilters()">
            <input type="time" id="time-end" class="time-input" onchange="applyFilters()">
        </div>

        <button class="apply-btn" onclick="toggleFilters()">Done</button>
    </div>

    <script>
        // --- MOCK DATABASE (Replace with your full JSON) ---
        const RAW_DB = [
          {"id":24,"name":"Ohab Zedek","address":"118 W. 95th St.","city":"New York","state":"NY","zip":"10025","lat":40.792404,"lng":-73.968576,"nusach":"Ashkenaz","rabbi":"Rabbi Allen Schwartz","phone":"212-749-5150","shacharis":{"sun":["08:00","09:00"],"mon_thu":["06:05","06:50"],"tue_wed_fri":["06:15","07:00"]},"mincha":{"week":[],"fri":[],"shabbos":[]},"maariv":{"week":[],"shabbos":[]}},
          {"id":27,"name":"Radio City Synagogue","address":"30 W. 47th St.","city":"New York","state":"NY","zip":"10036","lat":40.757217,"lng":-73.979682,"nusach":"Other","rabbi":"Rabbi Shmuel Levitin","mincha":{"week":["13:45","17:15"]},"maariv":{"week":[]}},
          {"id":1001,"name":"BMG","address":"617 6th St","city":"Lakewood","state":"NJ","zip":"08701","lat":40.0935,"lng":-74.2158,"nusach":"Ashkenaz","shacharis":{"sun":["07:40","08:45"]},"mincha":{"week":["13:45","15:25"]},"maariv":{"week":["22:00","23:00"]}},
          {"id":1003,"name":"Satmar","address":"405 Forest Ave","city":"Lakewood","state":"NJ","zip":"08701","lat":40.0898,"lng":-74.2165,"nusach":"Sefard","shacharis":{"sun":["07:30","08:30"]},"mincha":{"week":["14:00"]},"maariv":{"week":["20:00","21:00"]}},
           {"id":1004,"name":"Satmar 2","address":"405 Forest Ave","city":"Lakewood","state":"NJ","zip":"08701","lat":40.0899,"lng":-74.2166,"nusach":"Sefard","shacharis":{"sun":["07:35","08:35"]},"mincha":{"week":["14:05"]},"maariv":{"week":["20:05","21:05"]}}
        ];

        // --- STATE MANAGEMENT ---
        let map, markerCluster;
        let allMinyanim = [];
        let searchLocation = null; // { lat, lng }
        let currentRadius = 15; // Miles
        let filters = { tefillah: '', nusach: '', startTime: 0, endTime: 1440 };
        let markers = [];
        
        document.addEventListener("DOMContentLoaded", () => {
            // Set default times (All Day)
            document.getElementById('time-start').value = "00:00";
            document.getElementById('time-end').value = "23:59";
            
            processData(RAW_DB);
            populateNusachs();
        });

        // --- DATA PROCESSING ---
        function getDayKey() {
            const d = new Date().getDay();
            if(d === 0) return 'sun';
            if(d === 6) return 'shabbos'; // Logic below handles Shabbos separately if needed
            if(d === 1 || d === 4) return 'mon_thu';
            return 'tue_wed_fri';
        }

        function processData(db) {
            allMinyanim = [];
            const dayKey = getDayKey();
            const isShabbos = dayKey === 'shabbos';

            db.forEach(shul => {
                if(!shul.name) return;

                // Helper to add minyan
                const pushMinyan = (type, timeStr) => {
                    if(!timeStr) return;
                    const parsed = parseTimeStrict(type, timeStr);
                    if(!parsed) return;

                    allMinyanim.push({
                        shulId: shul.id,
                        name: shul.name,
                        address: shul.address,
                        nusach: shul.nusach || 'Other',
                        lat: shul.lat,
                        lng: shul.lng,
                        tefillah: type,
                        timeValue: parsed.totalMinutes,
                        displayTime: parsed.display,
                        rawShul: shul // Ref for details
                    });
                };

                // Extract times based on Day
                if(!isShabbos) {
                    if(shul.shacharis && shul.shacharis[dayKey]) shul.shacharis[dayKey].forEach(t => pushMinyan('Shacharis', t));
                    if(shul.mincha && shul.mincha.week) shul.mincha.week.forEach(t => pushMinyan('Mincha', t));
                    if(shul.maariv && shul.maariv.week) shul.maariv.week.forEach(t => pushMinyan('Maariv', t));
                }
            });
            
            // Sort by time
            allMinyanim.sort((a,b) => a.timeValue - b.timeValue);
        }

        // STRICT TIME LOGIC
        function parseTimeStrict(type, timeStr) {
            const raw = timeStr.replace(/[^0-9:]/g, "");
            if(!raw) return null;
            let [h, m] = raw.split(":").map(Number);
            
            // Logic: Shacharis = AM. Mincha/Maariv = PM (Unless 12).
            if(type === 'Shacharis') {
                // 7:00 -> 07:00. 
                // Edge case: unlikely to have Shacharis at 12pm or >12 in DB for morning.
            } else {
                // Mincha/Maariv
                if(h < 12) h += 12; // 1:00 -> 13:00. 6:00 -> 18:00
                // If h is 12 (e.g. 12:30), it stays 12 (12:30 PM)
            }

            const totalMinutes = (h * 60) + m;
            
            // Display Formatting
            const dispH = h > 12 ? h - 12 : (h === 0 || h === 12 ? 12 : h);
            const ampm = h >= 12 ? "PM" : "AM";
            const dispM = String(m).padStart(2, "0");

            return {
                totalMinutes,
                display: `${dispH}:${dispM} ${ampm}`
            };
        }

        function populateNusachs() {
            const nusachs = [...new Set(allMinyanim.map(m => m.nusach))].sort();
            const container = document.getElementById('nusach-chips');
            container.innerHTML = `<div class="chip active" onclick="setFilter('nusach', '', this)">All</div>`;
            nusachs.forEach(n => {
                const div = document.createElement('div');
                div.className = 'chip';
                div.innerText = n;
                div.onclick = function() { setFilter('nusach', n, this); };
                container.appendChild(div);
            });
        }

        // --- FILTERING ---
        function setFilter(key, val, el) {
            filters[key] = val;
            // Update UI
            const group = el.parentElement;
            group.querySelectorAll('.chip').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            applyFilters();
        }

        function applyFilters() {
            if(!searchLocation) return; // Don't filter if no location set

            // Parse time inputs
            const [sh, sm] = document.getElementById('time-start').value.split(':').map(Number);
            const [eh, em] = document.getElementById('time-end').value.split(':').map(Number);
            const startMin = (sh*60) + sm;
            const endMin = (eh*60) + em;

            const results = allMinyanim.filter(m => {
                // 1. Distance
                const dist = getDistance(searchLocation.lat, searchLocation.lng, m.lat, m.lng);
                m.distance = dist; // Cache distance
                if(dist > currentRadius) return false;

                // 2. Tefillah Type
                if(filters.tefillah && m.tefillah !== filters.tefillah) return false;

                // 3. Nusach
                if(filters.nusach && m.nusach !== filters.nusach) return false;

                // 4. Time
                if(m.timeValue < startMin || m.timeValue > endMin) return false;

                return true;
            });

            // Sort by time, then distance
            results.sort((a,b) => a.timeValue - b.timeValue);

            renderList(results);
            renderMap(results);
        }

        // --- RENDERING ---
        function renderList(data) {
            const container = document.getElementById('list-view');
            if(data.length === 0) {
                container.innerHTML = `<div class="empty-state"><p>No minyanim found matching your filters.</p></div>`;
                return;
            }

            container.innerHTML = data.map(m => `
                <div class="minyan-card" onclick="openDetails(${m.shulId})">
                    <div class="info-zone">
                        <div class="shul-name">${m.name}</div>
                        <div class="shul-details">${m.address}</div>
                        <div class="nusach-badge n-${m.nusach.replace(/\s/g,'-')}">${m.nusach}</div>
                    </div>
                    <div class="map-zone" onclick="event.stopPropagation(); window.open('https://maps.google.com/?q=${m.lat},${m.lng}')">
                        <div class="time-big">${m.displayTime.split(' ')[0]}</div>
                        <div class="time-sub">${m.displayTime.split(' ')[1]} â€¢ ${m.tefillah}</div>
                        <div class="dist-tag">${m.distance.toFixed(1)} mi</div>
                    </div>
                </div>
            `).join('');
        }

        async function renderMap(data) {
            if(!map) return;
            const { AdvancedMarkerElement } = await google.maps.importLibrary("marker");

            // Clear existing
            if(markerCluster) markerCluster.clearMarkers();
            markers = [];

            // Group by location to prevent identical stacking
            const uniqueLocs = {};
            data.forEach(m => {
                const key = `${m.lat},${m.lng}`;
                // Keep the earliest minyan at this location for the marker label
                if(!uniqueLocs[key] || m.timeValue < uniqueLocs[key].timeValue) {
                    uniqueLocs[key] = m;
                }
            });

            const points = Object.values(uniqueLocs);

            points.forEach(m => {
                const pin = document.createElement("div");
                pin.className = "custom-marker";
                pin.textContent = m.displayTime.split(' ')[0]; // Show time

                const marker = new AdvancedMarkerElement({
                    map: null, // Clusterer handles map
                    position: { lat: m.lat, lng: m.lng },
                    content: pin,
                    title: m.name
                });
                
                // Click opens details
                marker.element.addEventListener('click', () => openDetails(m.shulId));
                markers.push(marker);
            });

            // Init Clusterer
            markerCluster = new markerClusterer.MarkerClusterer({ map, markers });
        }

        // --- MAP LOGIC ---
        async function initMap() {
            const { Map } = await google.maps.importLibrary("maps");
            const { PlaceAutocompleteElement } = await google.maps.importLibrary("places");

            map = new Map(document.getElementById("map-view"), {
                center: { lat: 40.090, lng: -74.215 }, // Lakewood default
                zoom: 13,
                disableDefaultUI: true,
                mapId: "DEMO_MAP_ID" // Required for AdvancedMarker
            });

            // Show "Search this area" on drag
            map.addListener('dragend', () => {
                document.getElementById('search-area-btn').style.display = "flex";
            });

            // Autocomplete Setup
            const ac = new PlaceAutocompleteElement();
            ac.setAttribute("types", "(cities)"); // Limit to cities/zips
            document.getElementById('autocomplete-container').appendChild(ac);
            
            ac.addEventListener("gmp-select", async (e) => {
                const place = e.placePrediction.toPlace();
                await place.fetchFields({ fields: ["location"] });
                updateLocation(place.location.lat(), place.location.lng());
            });
        }

        function updateLocation(lat, lng) {
            searchLocation = { lat, lng };
            map.setCenter({ lat, lng });
            map.setZoom(14);
            document.getElementById('search-area-btn').style.display = "none";
            applyFilters();
            
            // Logic for switching views if on map
            // document.getElementById('list-view').style.display = "block";
        }

        function searchCurrentMapArea() {
            const c = map.getCenter();
            updateLocation(c.lat(), c.lng());
        }

        function useMyLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((pos) => {
                    updateLocation(pos.coords.latitude, pos.coords.longitude);
                });
            } else {
                alert("Geolocation is not supported by this browser.");
            }
        }

        // --- DRAWER & UTILS ---
        function openDetails(shulId) {
            const shul = RAW_DB.find(s => s.id === shulId);
            if(!shul) return;

            const formatArr = (arr) => arr && arr.length ? arr.join(", ") : "<span style='color:#ccc'>None</span>";

            const html = `
                <div style="margin-bottom:20px;">
                    <h2 style="margin:0; color:var(--primary);">${shul.name}</h2>
                    <div style="color:#666; margin-top:4px;">${shul.address}</div>
                    ${shul.rabbi ? `<div style="margin-top:5px; font-weight:600;">${shul.rabbi}</div>` : ''}
                    <div class="nusach-badge n-${(shul.nusach||'').replace(/\s/g,'-')}">${shul.nusach}</div>
                </div>

                <div style="background:#fafafa; padding:15px; border-radius:12px;">
                    <h4 style="margin:0 0 10px 0; color:#333;">Today's Minyanim</h4>
                    ${getTodayMinyanimHTML(shul.id)}
                </div>

                <h4 style="margin:20px 0 10px;">Full Schedule</h4>
                <div class="schedule-grid">
                    <div class="schedule-row"><span class="day-label">Shacharis Sun</span> <span class="times-list">${formatArr(shul.shacharis?.sun)}</span></div>
                    <div class="schedule-row"><span class="day-label">Shacharis M/Th</span> <span class="times-list">${formatArr(shul.shacharis?.mon_thu)}</span></div>
                    <div class="schedule-row"><span class="day-label">Mincha Wk</span> <span class="times-list">${formatArr(shul.mincha?.week)}</span></div>
                    <div class="schedule-row"><span class="day-label">Maariv Wk</span> <span class="times-list">${formatArr(shul.maariv?.week)}</span></div>
                </div>
            `;
            
            document.getElementById('drawer-content').innerHTML = html;
            document.getElementById('details-drawer').classList.add('open');
            document.getElementById('scrim').style.display = 'block';
        }

        function getTodayMinyanimHTML(id) {
            // Get all flattened minyanim for this shul that are valid for today
            const mins = allMinyanim.filter(m => m.shulId === id);
            if(!mins.length) return "No minyanim found for today.";
            return mins.map(m => `
                <div style="display:flex; justify-content:space-between; margin-bottom:5px; font-size:15px;">
                    <span style="font-weight:600; color:var(--primary);">${m.displayTime}</span>
                    <span>${m.tefillah}</span>
                </div>
            `).join('');
        }

        function closeDetails() {
            document.getElementById('details-drawer').classList.remove('open');
            document.getElementById('scrim').style.display = 'none';
        }

        function toggleFilters() {
            const d = document.getElementById('filter-drawer');
            d.style.display = (d.style.display === 'block') ? 'none' : 'block';
        }

        function toggleView() {
            const list = document.getElementById('list-view');
            const icon = document.getElementById('view-icon');
            if(list.style.display === 'none') {
                list.style.display = 'block';
                icon.innerText = 'map';
            } else {
                list.style.display = 'none';
                icon.innerText = 'list';
            }
        }

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 3958.8; // Radius of the Earth in miles
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                    Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                    Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Initialize Google Maps
        window.initApp = initMap;
    </script>
    
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOpNebt0dPJUmiEw-i1W-Dx_UezLpIvxI&loading=async&libraries=places,maps,marker&callback=initApp"></script>
</body>
</html>
